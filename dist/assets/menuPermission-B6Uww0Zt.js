import{_ as E,k as c,r as u,o as K,h as S,w as l,f as _,d as s,l as x,fA as z,M as D}from"./index-Dz8v1PLH.js";import{r as y}from"./role-TbSjh4YF.js";import{m as I}from"./menu-BvWPHOYp.js";const O={class:"w-full"},j={class:"tree-container p-2"},q={__name:"menuPermission",emits:["success"],setup(F,{expose:V,emit:C}){const r=c(!1),v=c(!0),h=c([]),p=c([]),f=c(!1),i=c(),d=c({name:void 0,code:void 0}),N=C,M=async e=>{r.value=!0,d.value={id:e.id,name:e.name,code:e.code},g(!1),b(!1),k(!1),await w(e.id)},g=e=>{i.value.maTree.expandAll(e)},b=e=>{i.value.maTree.checkAll(e)},k=e=>{f.value=e},T=e=>{const a=i.value.maTree,n=a.getExpandedNodes().map(o=>o.id);a.expandNode(e,!n.includes(e[0]))},w=async e=>{v.value=!0;const a=await I.tree({scope:!0});h.value=a.data;const n=await y.getMenuByRole(e);p.value=n.data[0].menus.map(o=>o.id),p.value.length>0&&k(!0),v.value=!1},B=async e=>{const n=i.value.maTree.getCheckedNodes().map(m=>m.id),o=await y.updateMenuPermission(d.value.id,{menu_ids:n});o.success&&D.success(o.message),N("success"),e(!0)},U=()=>r.value=!1;return V({open:M}),(e,a)=>{const n=u("a-input"),o=u("a-form-item"),m=u("a-checkbox"),P=u("a-space"),A=u("a-spin"),L=u("a-form"),R=u("a-modal");return K(),S(R,{visible:r.value,"onUpdate:visible":a[4]||(a[4]=t=>r.value=t),onCancel:U,onBeforeOk:B},{title:l(()=>[_("菜单权限")]),default:l(()=>[s(L,{model:d.value},{default:l(()=>[s(o,{label:"角色名称",field:"name"},{default:l(()=>[s(n,{disabled:"",modelValue:d.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>d.value.name=t)},null,8,["modelValue"])]),_:1}),s(o,{label:"角色标识",field:"code"},{default:l(()=>[s(n,{disabled:"",modelValue:d.value.code,"onUpdate:modelValue":a[1]||(a[1]=t=>d.value.code=t)},null,8,["modelValue"])]),_:1}),s(o,{label:"菜单列表",field:"menu_ids"},{default:l(()=>[s(A,{loading:v.value,tip:"菜单加载中...",class:"w-full"},{default:l(()=>[x("div",O,[s(P,{class:"mt-1.5",size:"large"},{default:l(()=>[s(m,{onChange:g},{default:l(()=>[_("展开/折叠")]),_:1}),s(m,{onChange:b},{default:l(()=>[_("全选/全不选")]),_:1}),s(m,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=t=>f.value=t),onChange:k},{default:l(()=>[_("关闭父子级联动")]),_:1},8,["modelValue"])]),_:1}),x("div",j,[s(z,{ref_key:"tree",ref:i,data:h.value,checkable:"",fieldNames:{title:"label",key:"id"},searchPlaceholder:"过滤菜单","checked-keys":p.value,"onUpdate:checkedKeys":a[3]||(a[3]=t=>p.value=t),"check-strictly":f.value,"virtual-list-props":{height:300},onClick:T},null,8,["data","checked-keys","check-strictly"])])])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}},Q=E(q,[["__scopeId","data-v-2919ca43"]]);export{Q as default};
