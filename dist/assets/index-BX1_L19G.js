import{g as f}from"./generate-yrvGfmnL.js";import{k as p,s as W,b as z,S as R,r as s,fA as F,o as a,c as G,d as e,w as o,N as r,h as u,f as i,M as _,m as q}from"./index-DRDJec9Y.js";import H from"./loadTable-CHZN2ADl.js";import J from"./preview-Xm9MSluf.js";import K from"./editInfo-D29YasjV.js";import"./dataMaintain-D-065KaB.js";import"./datasource-COYRo8WR.js";import"./menu-XIXDHaqP.js";import"./role-De5nkHs9.js";import"./dict-CqiniLj4.js";import"./settingComponent-CJfuGL3V.js";const Q={class:"ma-content-block lg:flex justify-between p-4"},X={name:"setting:code"},ue=Object.assign(X,{setup(Y){const k=p(),v=p(),C=p(),y=p(),g=p([]),S=W(),T=z(),I=[{label:"单表CRUD",value:"single"},{label:"树表CRUD",value:"tree"}],B=(n,t,m)=>{T.push("/autoform/"+n),S.addTag({name:t+" - test",title:m+" - 测试",path:"/autoform/"+n})},b=n=>{n&&k.value.refresh()},$=async n=>{const t=await f.sync(n);t.success&&_.success(t.message)},w=async n=>{_.info("代码生成下载中，请稍后");const t=await f.generateCode({ids:n.toString().split(",")});t.message&&!t.success?_.error(t.message):(q.download(t,"MineAdmin.zip"),_.success("代码生成成功，开始下载"))},A=()=>{if(g.value.length===0){_.error("至少要选择一条数据");return}w(g.value.join(","))},D=n=>g.value=n,N=R({api:f.getPageList,showIndex:!1,searchColNumber:3,searchLabelWidth:"75px",pageLayout:"fixed",rowSelection:{showCheckedAll:!0},operationColumn:!0,operationColumnWidth:350,delete:{show:!0,api:f.deletes,auth:["setting:code:delete"]}}),j=R([{title:"表名称",dataIndex:"table_name",search:!0,width:200},{title:"表描述",dataIndex:"table_comment",width:400},{title:"生成类型",dataIndex:"type",formType:"select",width:120,dict:{data:I,translation:!0}},{title:"创建时间",dataIndex:"created_at",width:180}]);return(n,t)=>{const m=s("icon-code"),x=s("a-button"),E=s("icon-export"),L=s("icon-link"),d=s("a-link"),M=s("icon-eye"),O=s("icon-sync"),P=s("a-popconfirm"),U=s("icon-edit"),V=s("ma-crud"),l=F("auth");return a(),G("div",Q,[e(V,{options:N,columns:j,ref_key:"crudRef",ref:k,onSelectionChange:D},{tableAfterButtons:o(()=>[r((a(),u(x,{type:"outline",onClick:A},{icon:o(()=>[e(m)]),default:o(()=>[i("生成代码")]),_:1})),[[l,["setting:code:generate"]]]),r((a(),u(x,{onClick:t[0]||(t[0]=()=>y.value.open()),type:"outline",status:"success"},{icon:o(()=>[e(E)]),default:o(()=>[i("装载数据表")]),_:1})),[[l,["setting:code:loadTable"]]])]),operationBeforeExtend:o(({record:c})=>[e(d,{onClick:h=>B(c.id,c.table_name,c.menu_name)},{default:o(()=>[e(L),i(" 测试")]),_:2},1032,["onClick"]),r((a(),u(d,{onClick:h=>C.value.open(c.id)},{default:o(()=>[e(M),i(" 预览")]),_:2},1032,["onClick"])),[[l,["setting:code:preview"]]]),e(P,{content:"同步会重置字段配置生成信息，确定同步吗?",position:"bottom",onOk:h=>$(c.id)},{default:o(()=>[r((a(),u(d,null,{default:o(()=>[e(O),i(" 同步")]),_:1})),[[l,["setting:code:sync"]]])]),_:2},1032,["onOk"]),r((a(),u(d,{onClick:()=>v.value.open(c.id)},{default:o(()=>[e(U),i(" 编辑")]),_:2},1032,["onClick"])),[[l,["setting:code:update"]]]),r((a(),u(d,{onClick:h=>w(c.id)},{default:o(()=>[e(m),i(" 生成代码")]),_:2},1032,["onClick"])),[[l,["setting:code:generate"]]])]),_:1},8,["options","columns"]),e(H,{ref_key:"loadTableRef",ref:y,onSuccess:b},null,512),e(J,{ref_key:"previewRef",ref:C},null,512),e(K,{ref_key:"editRef",ref:v,onSuccess:b},null,512)])}}});export{ue as default};
